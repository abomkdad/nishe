<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø¹Ø±ÙˆØ¶ Ø§Ù„Ø¹Ø·ÙˆØ± Ø§Ù„Ù†ÙŠØ´ ÙˆØ§Ù„Ø³Ù„ÙƒØªÙ Ø§Ù„Ø­ØµØ±ÙŠØ©</title>
    
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

    <style>
        body { font-family: Tahoma, sans-serif; margin: 0; padding: 0; background-color: #f4f4f4; color: #333; }
        header { background-color: #5d4037; color: white; padding: 20px; text-align: center; }
        h1 { margin: 0; }
        main { display: flex; max-width: 1200px; margin: 20px auto; padding: 0 15px; flex-wrap: wrap; }
        section { flex: 3; padding: 20px; background: white; border-radius: 8px; margin-bottom: 20px; }
        #cart-summary { flex: 1; padding: 20px; background: #fff8e1; border: 1px solid #ffecb3; border-radius: 8px; position: sticky; top: 20px; height: fit-content; min-width: 250px; margin-right: 20px; }
        
        /* ØªØµÙ…ÙŠÙ… Ø§Ù„ÙƒØ§Ø±ÙˆØ³ÙŠÙ„ (Ø¹Ø±Ø¶ Ø£ÙÙ‚ÙŠ ÙˆÙ‚Ø§Ø¨Ù„ Ù„Ù„ØªÙ…Ø±ÙŠØ±) */
        .perfume-carousel { 
            display: flex;
            overflow-x: auto; /* ØªÙ…ÙƒÙŠÙ† Ø§Ù„ØªÙ…Ø±ÙŠØ± Ø§Ù„Ø£ÙÙ‚ÙŠ */
            scroll-snap-type: x mandatory; /* Ù„Ø¬Ø¹Ù„ Ø§Ù„ØªÙ…Ø±ÙŠØ± Ø£ÙƒØ«Ø± Ø³Ù„Ø§Ø³Ø© */
            padding: 10px 0;
            gap: 15px;
            margin-top: 15px;
            -webkit-overflow-scrolling: touch; /* ØªØ­Ø³ÙŠÙ† ØªØ¬Ø±Ø¨Ø© Ø§Ù„ØªÙ…Ø±ÙŠØ± Ø¹Ù„Ù‰ iOS */
        }
        
        .perfume-item { 
            flex: 0 0 auto; /* Ù…Ù†Ø¹ Ø§Ù„Ø¹Ù†Ø§ØµØ± Ù…Ù† Ø§Ù„ØªÙ…Ø¯Ø¯ ÙˆØªØ­Ø¯ÙŠØ¯ Ø¹Ø±Ø¶Ù‡Ø§ */
            width: 180px; /* Ø¹Ø±Ø¶ Ø«Ø§Ø¨Øª Ù„ÙƒÙ„ Ø¹Ù†ØµØ± */
            border: 1px solid #ddd; padding: 10px; text-align: center; background: #fff; border-radius: 6px; 
            scroll-snap-align: start; /* Ù…Ø­Ø§Ø°Ø§Ø© ÙƒÙ„ Ø¹Ù†ØµØ± Ù…Ø¹ Ø¨Ø¯Ø§ÙŠØ© Ù…Ù†Ø·Ù‚Ø© Ø§Ù„ØªÙ…Ø±ÙŠØ± */
            transition: transform 0.2s; 
        }
        
        .perfume-item:hover { transform: translateY(-3px); box-shadow: 0 4px 8px rgba(0,0,0,0.1); }
        .perfume-item img { width: 100%; height: auto; max-height: 180px; object-fit: cover; border-radius: 4px; margin-bottom: 10px; }
        .add-to-cart { background-color: #8d6e63; color: white; border: none; padding: 8px 15px; cursor: pointer; border-radius: 4px; margin-top: 10px; font-weight: bold; width: 100%; }
        #cart-list { list-style: none; padding: 0; }
        #total-price { font-weight: bold; color: #b71c1c; font-size: 1.5em; }
        .gift { color: green; font-weight: bold; }
        .discount { color: orange; font-weight: bold; }
        #whatsapp-send-button { background-color: #25D366; color: white; border: none; padding: 12px; width: 100%; margin-top: 15px; border-radius: 6px; cursor: pointer; font-size: 1.1em; font-weight: bold; }
        @media (max-width: 900px) {
            main { flex-direction: column; }
            #cart-summary { margin-right: 0; order: -1; }
        }
    </style>
</head>
<body>
    <header>
        <h1>âœ¨ Ø¹Ø±ÙˆØ¶ Ø§Ù„Ø¹Ø·ÙˆØ± Ø§Ù„ÙØ§Ø®Ø±Ø© Ù„Ø§ ØªÙÙ‚Ø§ÙˆÙ…! âœ¨</h1>
        <p>â­ Ø§Ø®ØªØ± Ø¹Ø·ÙˆØ± **Ø§Ù„Ù†ÙŠØ´** ÙˆØ§Ø³ØªÙØ¯ Ù…Ù† Ø§Ù„Ø®ØµÙˆÙ…Ø§Øª Ø£Ùˆ Ø§Ù„Ù‡Ø¯Ø§ÙŠØ§ Ø¹Ù„Ù‰ Ø¹Ø·ÙˆØ± **Ø§Ù„Ø³Ù„ÙƒØªÙ**.</p>
    </header>

    <main>
        <section id="perfume-display">
            <h2>Ø¬Ø§Ø±Ù ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¹Ø·ÙˆØ±...</h2>
        </section>

        <aside id="cart-summary">
            <h2>ğŸ›’ Ù…Ù„Ø®Øµ Ø§Ù„Ø³Ù„Ø©</h2>
            <ul id="cart-list"></ul>
            <h3>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: <span id="total-price">0.00 â‚ª</span></h3>
            
            <button id="whatsapp-send-button" disabled>
                Ø£Ø±Ø³Ù„ Ù„ÙŠ Ø§Ù„Ø·Ù„Ø¨ Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨
            </button>
            
            <p style="font-size: 0.85em; margin-top: 15px; color: #666;">* ÙŠØªÙ… ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø¹Ø±Ø¶ ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§ Ø¹Ù„Ù‰ Ø£Ø±Ø®Øµ Ø¹Ø·Ø± Ø³Ù„ÙƒØªÙ ÙÙŠ Ø§Ù„Ø³Ù„Ø©.</p>
        </aside>
    </main>

    <script>
        // ******************************************************
        // 1. Ø±Ø§Ø¨Ø· JSON/GViz Ù…Ù† Ù…Ù„Ù Google Sheet Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ
        const SHEET_URL = 'https://docs.google.com/spreadsheets/d/1g3_D2NBwT27O2OI-v1R5tAB2QCfF3_ZCUL9sSLoCv54/gviz/tq?tqx=out:json';
        
        // 2. Ø±Ù‚Ù… Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨ Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ
        const PHONE_NUMBER = "972522511749"; 
        
        // 3. Ø±Ù…Ø² Ø§Ù„Ø¹Ù…Ù„Ø© (Ø§Ù„Ø´ÙŠÙƒÙ„)
        const CURRENCY_SYMBOL = " â‚ª";

        // 4. Ù†Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ø£Ø³Ø·Ø± Ù„Ù„ØªØµÙ†ÙŠÙ
        const ROWS_RANGES = {
            'selective_men': { start: 2, end: 109 },
            'selective_woman': { start: 110, end: 231 },
            'niche': { start: 232, end: 289 }
        };
        // ******************************************************

        let allPerfumes = [];
        let cart = [];

        // Ø¯Ø§Ù„Ø© Ù„Ø¥Ù†Ø´Ø§Ø¡ Ø¹Ù†ØµØ± Ø¹Ø·Ø± HTML
        function createPerfumeItem(perfume) {
            const div = document.createElement('div');
            div.className = 'perfume-item';
            div.dataset.id = perfume.id;
            div.dataset.type = perfume.type;
            div.dataset.price = perfume.price;
            div.dataset.name = perfume.name;

            let imgUrl = perfume.image && perfume.image.trim() ? perfume.image : 'https://via.placeholder.com/180?text=No+Image';

            // Ù…Ù†Ø·Ù‚ ØªØµØ­ÙŠØ­ Ø§Ù„Ø±Ø§Ø¨Ø· Ù„Ø¶Ù…Ø§Ù† HTTPS
            if (imgUrl.startsWith('http://') && !imgUrl.startsWith('https://')) {
                imgUrl = imgUrl.replace('http://', 'https://');
            }

            div.innerHTML = `
                <img src="${imgUrl}" alt="${perfume.name}" onerror="this.onerror=null;this.src='https://via.placeholder.com/180?text=No+Image';">
                <h3>${perfume.name}</h3>
                <p>Ø§Ù„Ø³Ø¹Ø±: ${perfume.price.toFixed(2)}${CURRENCY_SYMBOL}</p>
                <button class="add-to-cart">Ø£Ø¶Ù Ù„Ù„Ø³Ù„Ø©</button>
            `;
            return div;
        }

        // Ø¯Ø§Ù„Ø© Ø¹Ø±Ø¶ Ø§Ù„Ø¹Ø·ÙˆØ± ÙÙŠ ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
        function renderPerfumes() {
            const displaySection = document.getElementById('perfume-display');
            displaySection.innerHTML = ''; 

            const nichePerfumes = allPerfumes.filter(p => p.type === 'niche');
            const selectiveMenPerfumes = allPerfumes.filter(p => p.type === 'selective_men');
            const selectiveWomanPerfumes = allPerfumes.filter(p => p.type === 'selective_woman');
            
            // 1. Ø¹Ø±Ø¶ Ø¹Ø·ÙˆØ± Ø§Ù„Ù†ÙŠØ´ (Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ø£ÙˆÙ„)
            displaySection.innerHTML += '<h2>Ø¹Ø·ÙˆØ± Ø§Ù„Ù†ÙŠØ´ Ø§Ù„ÙØ§Ø®Ø±Ø©</h2><div class="perfume-carousel" id="niche-carousel"></div>';
            const nicheCarousel = document.getElementById('niche-carousel');
            nichePerfumes.forEach(p => nicheCarousel.appendChild(createPerfumeItem(p)));

            // 2. Ø¹Ø±Ø¶ Ø¹Ø·ÙˆØ± Ø³Ù„ÙƒØªÙ Ø±Ø¬Ø§Ù„ÙŠ (Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ø«Ø§Ù†ÙŠ)
            displaySection.innerHTML += '<hr style="margin: 30px 0;"><h2>Ø¹Ø·ÙˆØ± Ø³Ù„ÙƒØªÙ Ø±Ø¬Ø§Ù„ÙŠ</h2><div class="perfume-carousel" id="selective-men-carousel"></div>';
            const selectiveMenCarousel = document.getElementById('selective-men-carousel');
            selectiveMenPerfumes.forEach(p => selectiveMenCarousel.appendChild(createPerfumeItem(p)));
            
            // 3. Ø¹Ø±Ø¶ Ø¹Ø·ÙˆØ± Ø³Ù„ÙƒØªÙ Ù†Ø³Ø§Ø¦ÙŠ (Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ø«Ø§Ù„Ø«)
            displaySection.innerHTML += '<hr style="margin: 30px 0;"><h2>Ø¹Ø·ÙˆØ± Ø³Ù„ÙƒØªÙ Ù†Ø³Ø§Ø¦ÙŠ</h2><div class="perfume-carousel" id="selective-woman-carousel"></div>';
            const selectiveWomanCarousel = document.getElementById('selective-woman-carousel');
            selectiveWomanPerfumes.forEach(p => selectiveWomanCarousel.appendChild(createPerfumeItem(p)));

            document.querySelectorAll('.add-to-cart').forEach(button => {
                button.addEventListener('click', addToCart);
            });
        }

        // Ø¯Ø§Ù„Ø© Ù…Ø¹Ø§Ù„Ø¬Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø´ÙŠØª (Ø§Ù„Ù…ÙØ±Ø³Ù„Ø© Ù…Ù†Ùƒ)
        function fetchAndProcessProducts() {
            $.get(SHEET_URL, function (response) {
                try {
                    const jsonText = response.match(/google\.visualization\.Query\.setResponse\((.*)\)/)[1];
                    const jsonData = JSON.parse(jsonText);
                    const rows = jsonData.table.rows;

                    const processedProducts = [];

                    // ğŸ’¡ Ù…Ù„Ø§Ø­Ø¸Ø© Ø§Ù„Ø£Ø¹Ù…Ø¯Ø© Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„ØªØ±ØªÙŠØ¨ Ø§Ù„Ù…Ø´ØªØ±Ùƒ ÙÙŠ Ø§Ù„Ø´ÙŠØªØ§Øª
                    // C0: Name | C1: Description/Category | C2: Price | C3: Image Link | ... | C5: Price (Ø§Ù„Ø¹Ù…ÙˆØ¯ F)
                    
                    // ØªØ¬Ø§ÙˆØ² Ø§Ù„Ø³Ø·Ø± Ø§Ù„Ø£ÙˆÙ„ (Ø±Ø¤ÙˆØ³ Ø§Ù„Ø£Ø¹Ù…Ø¯Ø©) ÙˆÙŠØ¨Ø¯Ø£ Ø¹Ø¯ Ø§Ù„Ø£Ø³Ø·Ø± Ù…Ù† 2 ÙÙŠ Ø§Ù„Ø´ÙŠØª
                    for (let i = 0; i < rows.length; i++) {
                        
                        // Ø§Ù„Ø³Ø·Ø± Ø§Ù„ÙØ¹Ù„ÙŠ ÙÙŠ Ø§Ù„Ø´ÙŠØª Ù‡Ùˆ i + 2
                        const sheetRowNumber = i + 2; 
                        
                        // *** Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø¨Ø¹Ø¯ Ø§Ù„Ø³Ø·Ø± 289 ***
                        if (sheetRowNumber > 289) break; 
                        
                        const row = rows[i].c;

                        // Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙˆØªØ¬Ù†Ø¨ Ø§Ù„Ø£Ø®Ø·Ø§Ø¡ Ø¹Ù†Ø¯ ÙˆØ¬ÙˆØ¯ Ø®Ù„Ø§ÙŠØ§ ÙØ§Ø±ØºØ©
                        const productName = row[0]?.v || 'Ø¹Ø·Ø± ØºÙŠØ± Ù…Ø³Ù…Ù‰';     
                        const productCategoryRaw = row[1]?.v || ''; 
                        const productPriceC2 = parseFloat(row[2]?.v) || 0; 
                        const productImageLink = row[3]?.v || ''; 
                        const priceFromF = parseFloat(row[5]?.v) || 0; // C5 (Ø§Ù„Ø¹Ù…ÙˆØ¯ F)
                        
                        // Ù†Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø³Ø¹Ø± Ù…Ù† Ø§Ù„Ø¹Ù…ÙˆØ¯ F (C5) ÙƒÙ…Ø§ Ø·Ù„Ø¨ØªØŒ ÙˆÙ†ØªØ¬Ø§Ù‡Ù„ Ø§Ù„Ø³Ø¹Ø± ÙÙŠ C2 Ø¥Ø°Ø§ ÙƒØ§Ù† F ØµØ§Ù„Ø­Ø§Ù‹
                        const finalPrice = priceFromF > 0 ? priceFromF : productPriceC2;

                        // ØªØ¬Ø§Ù‡Ù„ Ø§Ù„Ø³Ø·ÙˆØ± Ø§Ù„ØªÙŠ Ù„Ø§ ØªØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø§Ø³Ù… Ø£Ùˆ Ø³Ø¹Ø± ØµØ§Ù„Ø­
                        if (!productName || finalPrice === 0) continue; 
                        
                        let type = '';
                        let namePrefix = '';
                        
                        // *** Ù…Ù†Ø·Ù‚ Ø§Ù„ØªØµÙ†ÙŠÙ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø±Ù‚Ù… Ø§Ù„Ø³Ø·Ø± ***
                        if (sheetRowNumber >= ROWS_RANGES.niche.start && sheetRowNumber <= ROWS_RANGES.niche.end) {
                            type = 'niche';
                        } else if (sheetRowNumber >= ROWS_RANGES.selective_men.start && sheetRowNumber <= ROWS_RANGES.selective_men.end) {
                            type = 'selective_men';
                            namePrefix = 'Ø±Ø¬Ø§Ù„ÙŠ: ';
                        } else if (sheetRowNumber >= ROWS_RANGES.selective_woman.start && sheetRowNumber <= ROWS_RANGES.selective_woman.end) {
                            type = 'selective_woman';
                            namePrefix = 'Ù†Ø³Ø§Ø¦ÙŠ: ';
                        } else {
                            continue; // ØªØ¬Ø§Ù‡Ù„ Ø£ÙŠ Ø³Ø·Ø± Ø®Ø§Ø±Ø¬ Ø§Ù„Ù†Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©
                        }

                        processedProducts.push({
                            id: productName.substring(0, 50) + '-' + sheetRowNumber,
                            name: namePrefix + productName,
                            price: finalPrice,
                            image: productImageLink,
                            type: type // niche, selective_men, selective_woman
                        });
                    }

                    allPerfumes = processedProducts;
                    renderPerfumes();
                    document.getElementById('whatsapp-send-button').disabled = false;

                } catch (e) {
                    console.error("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø´ÙŠØª:", e);
                    document.getElementById('perfume-display').innerHTML = '<h2>Ø¹Ø°Ø±Ø§Ù‹ØŒ Ù„Ù… Ù†ØªÙ…ÙƒÙ† Ù…Ù† ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ø·ÙˆØ±. ØªØ­Ù‚Ù‚ Ù…Ù† Ø±Ø§Ø¨Ø· Ø§Ù„Ø´ÙŠØª ÙˆØµÙ„Ø§Ø­ÙŠØ© Ø§Ù„Ø£Ø¹Ù…Ø¯Ø©.</h2>';
                }
            });
        }
        
        // Ø¯Ø§Ù„Ø© Ø¥Ø¶Ø§ÙØ© Ø¹Ø·Ø± Ù„Ù„Ø³Ù„Ø© (Ù…Ø­Ø¯Ø«Ø©)
        function addToCart(event) {
            const itemElement = event.target.closest('.perfume-item');
            if (!itemElement) return;

            const itemId = itemElement.dataset.id;
            
            // ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø§Ù„Ù…Ù†ØªØ¬ Ø¨Ø§Ù„ÙØ¹Ù„ (Ù…Ù‡Ù… Ù„Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¹Ø±ÙˆØ¶)
            // Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙŠØ¶ÙŠÙ Ø³Ù„ÙƒØªÙØŒ ÙŠÙ…ÙƒÙ† Ø§Ù„Ø³Ù…Ø§Ø­ Ø¨Ø§Ù„ØªÙƒØ±Ø§Ø± Ø¨Ø¹Ø¯ Ø§Ù„Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø¬Ø§Ù†ÙŠ
            // Ù„ÙƒÙ† Ù‡Ù†Ø§ Ù†ÙƒØªÙÙŠ Ø¨Ø§Ù„Ù…Ù†Ø·Ù‚ Ø§Ù„Ø¨Ø³ÙŠØ·: Ù„Ø§ ØªÙƒØ±Ø± Ù†ÙØ³ Ø§Ù„Ø¹Ø·Ø± Ø¨Ù†ÙØ³ Ø§Ù„Ù…Ø¹Ø±Ù
            if (cart.some(item => item.id === itemId)) {
                 // Ù„Ù„Ø³Ù…Ø§Ø­ Ø¨Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø³Ù„ÙƒØªÙ Ø¨Ø¹Ø¯ Ø§Ù„Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø¬Ø§Ù†ÙŠØŒ Ø³Ù†Ù‚ÙˆÙ… Ø¨ØªØºÙŠÙŠØ± Ø§Ù„Ù…Ø¹Ø±Ù
                 // Ù„ÙƒÙ† Ø³Ù†Ø¨Ù‚ÙŠ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ù†Ø·Ù‚ Ø§Ù„Ø­Ø§Ù„ÙŠ Ù„Ø¹Ø¯Ù… Ø§Ù„ØªØ¹Ù‚ÙŠØ¯
                 alert("Ù‡Ø°Ø§ Ø§Ù„Ø¹Ø·Ø± Ù…Ø¶Ø§Ù Ø¨Ø§Ù„ÙØ¹Ù„ Ø¥Ù„Ù‰ Ø§Ù„Ø³Ù„Ø©.");
                 return;
            }

            const item = {
                id: itemId,
                name: itemElement.dataset.name,
                type: itemElement.dataset.type,
                basePrice: parseFloat(itemElement.dataset.price),
                finalPrice: parseFloat(itemElement.dataset.price),
                isDiscounted: false,
                isFreeGift: false // Ù…Ø¤Ø´Ø± Ù„Ù„Ù‡Ø¯ÙŠØ© Ø§Ù„Ù…Ø¬Ø§Ù†ÙŠØ© Ø£Ùˆ Ø®ØµÙ… 50%
            };
            
            cart.push(item);
            updateCartAndOffers();
        }

        // Ø¯Ø§Ù„Ø© ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ø±ÙˆØ¶ (Ø§Ù„Ù…Ù†Ø·Ù‚ Ø§Ù„Ù…Ø¯Ù…Ø¬)
        function updateCartAndOffers() {
            // 1. Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø£Ø³Ø¹Ø§Ø± Ø§Ù„Ø³Ù„ÙƒØªÙ
            cart.forEach(item => {
                if (item.type.startsWith('selective')) {
                    item.finalPrice = item.basePrice; 
                    item.isDiscounted = false;
                    item.isFreeGift = false;
                }
            });

            // 2. Ø­Ø³Ø§Ø¨ Ø¹Ø¯Ø¯ Ø¹Ø·ÙˆØ± Ø§Ù„Ù†ÙŠØ´
            const nicheCount = cart.filter(item => item.type === 'niche').length;

            // 3. ØªØ­Ø¯ÙŠØ¯ Ø£Ø±Ø®Øµ Ø¹Ø·Ø± Ø³Ù„ÙƒØªÙ ÙÙŠ Ø§Ù„Ø³Ù„Ø© Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø¹Ø±Ø¶ Ø¹Ù„ÙŠÙ‡
            let selectiveItems = cart
                .filter(item => item.type.startsWith('selective')) // ÙŠØ´Ù…Ù„ Ø§Ù„Ø±Ø¬Ù„ ÙˆØ§Ù„Ù†Ø³Ø§Ø¡
                .sort((a, b) => a.basePrice - b.basePrice); 
            
            // ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø¹Ø±Ø¶ Ø¹Ù„Ù‰ Ø£Ø±Ø®Øµ Ø¹Ø·Ø± Ø³Ù„ÙƒØªÙ ÙˆØ§Ø­Ø¯ ÙÙ‚Ø·
            if (selectiveItems.length > 0) {
                const cheapestSelective = selectiveItems[0]; 

                if (nicheCount === 1) {
                    // Ø§Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø£ÙˆÙ„: 1 Ù†ÙŠØ´ = Ø³Ù„ÙƒØªÙ Ø¨Ù†ØµÙ Ø§Ù„Ø³Ø¹Ø± (50%)
                    cheapestSelective.finalPrice = cheapestSelective.basePrice / 2;
                    cheapestSelective.isDiscounted = true;
                    cheapestSelective.isFreeGift = false;

                } else if (nicheCount >= 2) {
                    // Ø§Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø«Ø§Ù†ÙŠ: 2 Ù†ÙŠØ´ Ø£Ùˆ Ø£ÙƒØ«Ø± = Ø³Ù„ÙƒØªÙ Ù‡Ø¯ÙŠØ© Ù…Ø¬Ø§Ù†ÙŠØ© (0$)
                    cheapestSelective.finalPrice = 0;
                    cheapestSelective.isDiscounted = true;
                    cheapestSelective.isFreeGift = true;
                }

                // 4. ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø¹Ø§Ø¯ÙŠ Ø¹Ù„Ù‰ Ø£ÙŠ Ø¹Ø·ÙˆØ± Ø³Ù„ÙƒØªÙ Ø£Ø®Ø±Ù‰ Ù…Ø¶Ø§ÙØ© Ø¨Ø¹Ø¯ Ø§Ù„Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø¬Ø§Ù†ÙŠ
                if (nicheCount >= 2 && selectiveItems.length > 1) {
                    // Ø§Ù„Ø¹Ø·Ø± Ø§Ù„Ø£ÙˆÙ„ Ù‡Ùˆ Ù…Ø¬Ø§Ù†ÙŠ (ØªÙ… Ø§Ù„ØªØ¹Ø§Ù…Ù„ Ù…Ø¹Ù‡ Ø£Ø¹Ù„Ø§Ù‡)
                    // Ø¨Ø§Ù‚ÙŠ Ø¹Ø·ÙˆØ± Ø§Ù„Ø³Ù„ÙƒØªÙ ØªØ¨Ù‚Ù‰ Ø¨Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø£ØµÙ„ÙŠ (ÙˆÙ‡Ùˆ Ù…Ø§ ØªÙ… ÙÙŠ Ø§Ù„Ø®Ø·ÙˆØ© 1)
                }
            }
            renderCartSummary();
        }

        // Ø¯Ø§Ù„Ø© Ù„Ø¹Ø±Ø¶ Ù…Ù„Ø®Øµ Ø§Ù„Ø³Ù„Ø©
        function renderCartSummary() {
            const cartList = document.getElementById('cart-list');
            const totalPriceElement = document.getElementById('total-price');
            let total = 0;
            cartList.innerHTML = ''; 

            cart.forEach(item => {
                total += item.finalPrice;
                const li = document.createElement('li');
                
                let priceText = `${item.finalPrice.toFixed(2)}${CURRENCY_SYMBOL}`;

                if (item.isDiscounted) {
                    if (item.isFreeGift) {
                        priceText = `<span class="gift">Ù‡Ø¯ÙŠØ© Ù…Ø¬Ø§Ù†ÙŠØ©!</span> <del>${item.basePrice.toFixed(2)}${CURRENCY_SYMBOL}</del>`;
                    } else {
                        priceText = `<span class="discount">${priceText}</span> <del>${item.basePrice.toFixed(2)}${CURRENCY_SYMBOL}</del> (Ø®ØµÙ… 50%)`;
                    }
                } else {
                    priceText = `${item.basePrice.toFixed(2)}${CURRENCY_SYMBOL}`;
                }

                li.innerHTML = `<strong>${item.name}</strong> (${item.type.includes('niche') ? 'Ù†ÙŠØ´' : 'Ø³Ù„ÙƒØªÙ'}): ${priceText}`;
                cartList.appendChild(li);
            });

            totalPriceElement.textContent = total.toFixed(2) + CURRENCY_SYMBOL;
        }

        // Ø¯Ø§Ù„Ø© Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨
        function sendOrderViaWhatsApp() {
            if (cart.length === 0) {
                alert("Ø³Ù„Ø© Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª ÙØ§Ø±ØºØ©.");
                return;
            }

            const nicheCount = cart.filter(item => item.type === 'niche').length;
            let message = "ğŸ‰ *Ø·Ù„Ø¨ Ø¹Ø·ÙˆØ± Ø¬Ø¯ÙŠØ¯:*\n\n*1. Ø§Ù„Ø¹Ø·ÙˆØ± Ø§Ù„Ù…Ø®ØªØ§Ø±Ø©:*\n";
            let total = 0;

            cart.forEach(item => {
                total += item.finalPrice;
                let priceText = `${item.finalPrice.toFixed(2)}${CURRENCY_SYMBOL}`;

                if (item.isDiscounted) {
                    priceText = (item.finalPrice === 0) 
                                ? "ğŸ *Ù‡Ø¯ÙŠØ© Ù…Ø¬Ø§Ù†ÙŠØ©*"
                                : "ğŸ’° *" + item.finalPrice.toFixed(2) + CURRENCY_SYMBOL + "* (Ø®ØµÙ… 50%)";
                } else {
                    priceText = item.basePrice.toFixed(2) + CURRENCY_SYMBOL;
                }

                message += `\n- ${item.name} (${item.type.includes('niche') ? 'Ù†ÙŠØ´' : 'Ø³Ù„ÙƒØªÙ'}): ${priceText}`;
            });

            let offerSummary = "\n\n*2. Ù…Ù„Ø®Øµ Ø§Ù„Ø¹Ø±Ø¶:*";
            if (nicheCount === 1) {
                offerSummary += "\n- ØªÙ… ØªØ·Ø¨ÙŠÙ‚ Ø¹Ø±Ø¶ *Ø¹Ø·Ø± Ø³Ù„ÙƒØªÙ Ø¨Ù†ØµÙ Ø§Ù„Ø³Ø¹Ø±*.";
            } else if (nicheCount >= 2) {
                offerSummary += "\n- ØªÙ… ØªØ·Ø¨ÙŠÙ‚ Ø¹Ø±Ø¶ *Ø¹Ø·Ø± Ø³Ù„ÙƒØªÙ Ù‡Ø¯ÙŠØ© Ù…Ø¬Ø§Ù†ÙŠØ©*.";
            } else {
                offerSummary += "\n- Ù„Ù… ÙŠØªÙ… ØªØ·Ø¨ÙŠÙ‚ Ø¹Ø±Ø¶.";
            }
            message += offerSummary;
            
            message += `\n\n====================\n`;
            message += `ğŸ’µ *Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ:* ${total.toFixed(2)}${CURRENCY_SYMBOL}`;
            
            const pageUrl = window.location.href; 
            message += `\n\nÙ„Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø·Ù„Ø¨ ÙˆØ±Ø¤ÙŠØ© Ø§Ù„ØµÙˆØ±ØŒ ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø±Ø¯ Ø¹Ù„Ù‰ Ù‡Ø°Ù‡ Ø§Ù„Ø±Ø³Ø§Ù„Ø©.\n(Ø±Ø§Ø¨Ø· Ø§Ù„Ø·Ù„Ø¨: ${pageUrl})`;

            const encodedMessage = encodeURIComponent(message);
            const whatsappUrl = `https://wa.me/${PHONE_NUMBER}?text=${encodedMessage}`;
            window.open(whatsappUrl, '_blank');
        }

        // ØªØ´ØºÙŠÙ„ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
        document.addEventListener('DOMContentLoaded', () => {
            fetchAndProcessProducts();
            document.getElementById('whatsapp-send-button').addEventListener('click', sendOrderViaWhatsApp);
        });
    </script>
</body>
</html>
