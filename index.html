<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title id="page-title">Ø¹Ø±ÙˆØ¶ Ø§Ù„Ø¹Ø·ÙˆØ± Ø§Ù„Ù†ÙŠØ´ ÙˆØ§Ù„Ø³Ù„ÙƒØªÙ Ø§Ù„Ø­ØµØ±ÙŠØ©</title>

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" />

  <style>
    :root {
      --primary-color: #5d4037;
      --secondary-color: #8d6e63;
      --background-color: #f4f4f4;
      --cart-color: #fff8e1;
      --whatsapp-color: #25d366;
      --delete-color: #d32f2f;
    }

    body {
      font-family: Tahoma, sans-serif;
      margin: 0;
      padding: 0 0 120px 0;
      background-color: var(--background-color);
      color: #333;
      min-height: 100vh;
    }

    header {
      background-color: var(--primary-color);
      color: #fff;
      padding: 15px 10px;
      text-align: center;
    }

    main {
      max-width: 1200px;
      margin: 0 auto;
      padding: 10px;
    }

    section {
      background: #fff;
      border-radius: 8px;
      margin-bottom: 20px;
      padding: 15px;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
    }

    /* ØªØµÙ…ÙŠÙ… Ø§Ù„ÙƒØ§Ø±ÙˆØ³ÙŠÙ„ (Ø¹Ø±Ø¶ Ø£ÙÙ‚ÙŠ Ù…Ø³ØªÙ‚Ù„) */
    .perfume-carousel {
      display: flex;
      overflow-x: auto;
      padding: 10px 0;
      gap: 12px;
      margin-top: 15px;
      -webkit-overflow-scrolling: touch;
      scrollbar-width: none;
      -ms-overflow-style: none;
    }
    .perfume-carousel::-webkit-scrollbar { display: none; }

    .perfume-item {
      flex: 0 0 150px;
      border: 1px solid #ddd;
      padding: 8px;
      text-align: center;
      background: #fff;
      border-radius: 6px;
      transition: transform 0.2s;
    }
    .perfume-item:hover { transform: translateY(-2px); }
    .perfume-item img {
      width: 100%;
      height: auto;
      max-height: 150px;
      object-fit: cover;
      border-radius: 4px;
      margin-bottom: 8px;
    }

    .add-to-cart {
      background-color: var(--secondary-color);
      color: #fff;
      border: none;
      padding: 7px 10px;
      cursor: pointer;
      border-radius: 4px;
      font-weight: bold;
      width: 100%;
    }

    /* Ø§Ù„Ø¹Ø±Ø¨Ø© Ø§Ù„Ø«Ø§Ø¨ØªØ© */
    #cart-container {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      width: 100%;
      z-index: 1000;
      background-color: #fff;
      box-shadow: 0 -4px 10px rgba(0, 0, 0, 0.1);
    }

    #cart-summary {
      background: var(--cart-color);
      padding: 10px 15px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
    }

    #cart-details { flex: 1 1 auto; display: flex; flex-direction: column; }

    #cart-list {
      list-style: none;
      padding: 0;
      margin: 5px 0;
      max-height: 60px;
      overflow-y: auto;
      font-size: 0.9em;
    }

    #cart-list li {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 2px 0;
    }

    .delete-item {
      cursor: pointer;
      color: var(--delete-color);
      margin-inline-end: 6px;
      font-size: 1em;
      opacity: 0.75;
      transition: opacity 0.2s;
    }
    .delete-item:hover { opacity: 1; }

    #total-price-display {
      font-weight: bold;
      color: #b71c1c;
      font-size: 1.3em;
      white-space: nowrap;
    }

    #whatsapp-send-button {
      background-color: var(--whatsapp-color);
      color: #fff;
      border: none;
      padding: 10px 15px;
      border-radius: 5px;
      cursor: pointer;
      font-size: 1em;
      font-weight: bold;
      white-space: nowrap;
    }

    #shipping-info { font-size: 0.8em; color: #555; }

    /* Ø²Ø± ÙˆØ§ØªØ³Ø§Ø¨ Ø§Ù„Ø¹Ø§Ø¦Ù… */
    #floating-whatsapp {
      position: fixed;
      bottom: 140px; /* ØªÙ… Ø±ÙØ¹Ù‡ Ù‚Ù„ÙŠÙ„Ø§Ù‹ */
      left: 15px;
      background-color: var(--whatsapp-color);
      color: #fff;
      padding: 8px 12px;
      border-radius: 50px;
      text-decoration: none;
      box-shadow: 0 4px 10px rgba(0,0,0,0.3);
      z-index: 1001;
      display: flex;
      align-items: center;
      font-size: 0.9em;
    }
    #floating-whatsapp i { font-size: 1.2em; margin-inline-end: 8px; }

    .offer-message {
      background-color: #e8f5e9;
      color: #1b5e20;
      padding: 10px;
      margin-bottom: 15px;
      border-radius: 5px;
      font-weight: bold;
      text-align: center;
      border: 1px solid #c8e6c9;
    }

    .gift { color: #1b5e20; font-weight: bold; }
    .discount { text-decoration: none; font-weight: bold; }

    /* ØªØ¹Ø¯ÙŠÙ„Ø§Øª Ø§Ù„Ù„ØºØ© */
    [lang="he"] { direction: rtl; }
    [lang="he"] #floating-whatsapp { left: auto; right: 15px; }
    [lang="he"] #floating-whatsapp i { margin-inline-start: 8px; margin-inline-end: 0; }
  
    /* Ø±ÙØ¹ Ø²Ø± ÙˆØ§ØªØ³Ø§Ø¨ Ù‚Ù„ÙŠÙ„Ø§Ù‹ */
    #floating-whatsapp { bottom: 150px !important; }
  </style>
</head>
<body lang="ar">
  <header>
    <h1 id="header-title"></h1>
    <p id="header-subtitle"></p>
  </header>

  <main>
    <section id="perfume-display">
      <h2 id="loading-message"></h2>
    </section>
  </main>

  <a id="floating-whatsapp" href="#" target="_blank">
    <i class="fab fa-whatsapp"></i> <span id="whatsapp-float-text"></span>
  </a>

  <div id="cart-container">
    <aside id="cart-summary">
      <div id="cart-details">
        <ul id="cart-list"></ul>
        <p id="shipping-info"></p>
        <div style="display:flex;justify-content:space-between;align-items:center;padding-top:5px;gap:10px;">
          <span id="total-text"></span>
          <span id="total-price-display">0.00 â‚ª</span>
        </div>
      </div>
      <button id="whatsapp-send-button" disabled></button>
    </aside>
  </div>

  <script>
    // Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ø¬Ø§ÙØ§Ø³ÙƒØ±Ø¨Øª ÙƒÙ…Ø§ Ù‡Ùˆ Ø¨Ø¯ÙˆÙ† ØªØºÙŠÙŠØ±
  </script>
<script>
// ===== JavaScript: ØªÙØ¹ÙŠÙ„ Ø§Ù„ØµÙØ­Ø© ÙˆØ¹Ø±Ø¶ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª =====
const SHEET_URL = 'https://docs.google.com/spreadsheets/d/1g3_D2NBwT27O2OI-v1R5tAB2QCfF3_ZCUL9sSLoCv54/gviz/tq?tqx=out:json';
const PHONE_NUMBER = '972522511749';
const CURRENCY_SYMBOL = ' â‚ª';
const SHIPPING_FEE = 50;

const DICT = {
  ar: {
    title: 'âœ¨ Ø¹Ø±ÙˆØ¶ Ø§Ù„Ø¹Ø·ÙˆØ± Ø§Ù„ÙØ§Ø®Ø±Ø© Ù„Ø§ ØªÙÙ‚Ø§ÙˆÙ…! âœ¨',
    subtitle: 'â­ Ø§Ø®ØªØ± Ø¹Ø·ÙˆØ± Ø§Ù„Ù†ÙŠØ´ ÙˆØ§Ø³ØªÙØ¯ Ù…Ù† Ø§Ù„Ø®ØµÙˆÙ…Ø§Øª Ø£Ùˆ Ø§Ù„Ù‡Ø¯Ø§ÙŠØ§.',
    loading: 'Ø¬Ø§Ø±Ù ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¹Ø·ÙˆØ±...',
    niche_header: 'Ø¹Ø·ÙˆØ± Ø§Ù„Ù†ÙŠØ´ Ø§Ù„ÙØ§Ø®Ø±Ø©',
    niche_offer_msg: 'Ù‚Ù… Ø¨Ø§Ø®ØªÙŠØ§Ø± Ø¹Ø·Ø± Ø£Ùˆ Ø¹Ø·Ø±ÙŠÙ† Ù†ÙŠØ´ Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ø¹Ø±Ø¶.',
    men_header: 'Ø¹Ø·ÙˆØ± Ø³Ù„ÙƒØªÙ Ø±Ø¬Ø§Ù„ÙŠ',
    woman_header: 'Ø¹Ø·ÙˆØ± Ø³Ù„ÙƒØªÙ Ù†Ø³Ø§Ø¦ÙŠ',
    add_to_cart: 'Ø£Ø¶Ù Ù„Ù„Ø³Ù„Ø©',
    total_text: 'Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ:',
    shipping_text: 'Ø±Ø³ÙˆÙ… Ø§Ù„ØªÙˆØµÙŠÙ„: ' + SHIPPING_FEE.toFixed(2) + CURRENCY_SYMBOL,
    complete_order: 'Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø·Ù„Ø¨',
    cart_empty: 'Ø³Ù„Ø© Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª ÙØ§Ø±ØºØ©.',
    item_added: 'Ù‡Ø°Ø§ Ø§Ù„Ø¹Ø·Ø± Ù…Ø¶Ø§Ù Ø¨Ø§Ù„ÙØ¹Ù„ Ø¥Ù„Ù‰ Ø§Ù„Ø³Ù„Ø©.',
    whatsapp_float: 'Ø£Ø±ØºØ¨ Ø¨Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø¹Ø±Ø¶ Ø§Ù„Ù†ÙŠØ´',
    msg_gift: 'Ù‡Ø¯ÙŠØ© Ù…Ø¬Ø§Ù†ÙŠØ©',
    msg_discount: 'Ø®ØµÙ… 50%',
    msg_order_complete: 'Ø·Ù„Ø¨ Ø¹Ø·ÙˆØ± Ø¬Ø¯ÙŠØ¯:',
    msg_no_offer: 'Ù„Ù… ÙŠØªÙ… ØªØ·Ø¨ÙŠÙ‚ Ø¹Ø±Ø¶.',
    type_men_prefix: 'Ø±Ø¬Ø§Ù„ÙŠ: ',
    type_woman_prefix: 'Ù†Ø³Ø§Ø¦ÙŠ: ',
    error_loading: 'Ø¹Ø°Ø±Ø§Ù‹ØŒ Ù„Ù… Ù†ØªÙ…ÙƒÙ† Ù…Ù† ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ø·ÙˆØ±. ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† Ø±Ø§Ø¨Ø· Ø§Ù„Ø´ÙŠØª Ù…Ù†Ø´ÙˆØ± Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­.'
  },
  he: {
    title: 'âœ¨ ××‘×¦×¢×™ ×‘×™×©×•× ×™×•×§×¨×ª×™×™×! âœ¨',
    subtitle: 'â­ ×‘×—×¨ ×‘×©××™ × ×™×© ×•×§×‘×œ ×”× ×—×•×ª ××• ××ª× ×•×ª.',
    loading: '×˜×•×¢×Ÿ ×‘×©××™×...',
    niche_header: '×‘×©××™ × ×™×© ×™×•×§×¨×ª×™×™×',
    niche_offer_msg: '×‘×—×¨ ×‘×•×©× × ×™×© ××—×“ ××• ×©× ×™×™× ×›×“×™ ×œ×§×‘×œ ××ª ×”××‘×¦×¢.',
    men_header: '×‘×©××™ ×¡×œ×§×˜×™×‘ ×œ×’×‘×¨',
    woman_header: '×‘×©××™ ×¡×œ×§×˜×™×‘ ×œ××™×©×”',
    add_to_cart: '×”×•×¡×£ ×œ×¡×œ',
    total_text: '×¡×”"×›:',
    shipping_text: '×“××™ ××©×œ×•×—: ' + SHIPPING_FEE.toFixed(2) + CURRENCY_SYMBOL,
    complete_order: '×¡×™×™× ×”×–×× ×”',
    cart_empty: '×”×¡×œ ×¨×™×§.',
    item_added: '×¤×¨×™×˜ ×–×” ×›×‘×¨ ×§×™×™× ×‘×¡×œ.',
    whatsapp_float: '×× ×™ ×¨×•×¦×” ××ª ××‘×¦×¢ ×”× ×™×©',
    msg_gift: '××ª× ×” ×—×™× ×',
    msg_discount: '50% ×”× ×—×”',
    msg_order_complete: '×”×–×× ×ª ×‘×©××™× ×—×“×©×”:',
    msg_no_offer: '×œ× ×”×•×—×œ ××‘×¦×¢.',
    type_men_prefix: '×’×‘×¨: ',
    type_woman_prefix: '××™×©×”: ',
    error_loading: '×× ×• ××¦×˜×¢×¨×™×, ×œ× ×”×¦×œ×—× ×• ×œ×˜×¢×•×Ÿ ××ª × ×ª×•× ×™ ×”×‘×©××™×. ×× × ×•×“× ×©×”×§×™×©×•×¨ ×œ×’×œ×™×•×Ÿ ×”× ×ª×•× ×™× ×¤×¢×™×œ ×•×¤×•×¨×¡×.'
  }
};

let currentLang = 'ar';
let allPerfumes = [];
let cart = [];

function setLanguage() {
  const browserLang = navigator.language.substring(0, 2).toLowerCase();
  if (browserLang === 'he' || document.documentElement.lang === 'he') {
    currentLang = 'he';
    document.documentElement.setAttribute('lang', 'he');
    document.documentElement.setAttribute('dir', 'rtl');
  } else {
    currentLang = 'ar';
    document.documentElement.setAttribute('lang', 'ar');
    document.documentElement.setAttribute('dir', 'rtl');
  }
  updateTexts();
}

function updateTexts() {
  const t = DICT[currentLang];
  document.getElementById('page-title').textContent = t.title;
  document.getElementById('header-title').textContent = t.title;
  document.getElementById('header-subtitle').textContent = t.subtitle;
  document.getElementById('loading-message').textContent = t.loading;
  document.getElementById('total-text').textContent = t.total_text;
  document.getElementById('whatsapp-send-button').textContent = t.complete_order;
  document.getElementById('whatsapp-float-text').textContent = t.whatsapp_float;
  const floatA = document.getElementById('floating-whatsapp');
  floatA.href = `https://wa.me/${PHONE_NUMBER}?text=${encodeURIComponent(t.whatsapp_float)}`;
  floatA.title = t.whatsapp_float;
}

function addToCart(e) {
  const card = e.target.closest('.perfume-item');
  const id = card.dataset.id;
  const exists = cart.some(i => i.id === id);
  const t = DICT[currentLang];
  if (exists) { alert(t.item_added); return; }
  const basePrice = parseFloat(card.dataset.price) || 0;
  cart.push({ id, name: card.dataset.name, type: card.dataset.type, basePrice, finalPrice: basePrice, isDiscounted: false, isFreeGift: false });
  updateCartAndOffers();
}

function removeItemFromCart(index) {
  cart.splice(index, 1);
  updateCartAndOffers();
}

function createPerfumeItem(perfume) {
  const div = document.createElement('div');
  div.className = 'perfume-item';
  div.dataset.id = perfume.id;
  div.dataset.type = perfume.type;
  div.dataset.price = perfume.price;
  div.dataset.name = perfume.name;

  let imgUrl = perfume.image && perfume.image.trim() ? perfume.image : 'https://via.placeholder.com/180?text=No+Image';
  if (imgUrl.startsWith('http://') && !imgUrl.startsWith('https://')) { imgUrl = imgUrl.replace('http://', 'https://'); }

  const t = DICT[currentLang];
  div.innerHTML = `
    <img src="${imgUrl}" alt="${perfume.name}" onerror="this.onerror=null;this.src='https://via.placeholder.com/180?text=No+Image';">
    <h3>${perfume.name}</h3>
    <p>${perfume.price.toFixed(2)}${CURRENCY_SYMBOL}</p>
    <button class="add-to-cart">${t.add_to_cart}</button>
  `;
  return div;
}

function renderPerfumes() {
  const displaySection = document.getElementById('perfume-display');
  displaySection.innerHTML = '';

  const nichePerfumes = allPerfumes.filter(p => p.type === 'niche');
  const selectiveMenPerfumes = allPerfumes.filter(p => p.type === 'selective_men');
  const selectiveWomanPerfumes = allPerfumes.filter(p => p.type === 'selective_woman');

  const t = DICT[currentLang];
  displaySection.innerHTML += `
    <div class="offer-message">${t.niche_offer_msg}</div>
    <h2>${t.niche_header}</h2>
    <div class="perfume-carousel" id="niche-carousel"></div>
  `;
  const nicheCarousel = document.getElementById('niche-carousel');
  nichePerfumes.forEach(p => nicheCarousel.appendChild(createPerfumeItem(p)));

  displaySection.innerHTML += `<hr style="margin: 30px 0;"><h2>${t.men_header}</h2><div class="perfume-carousel" id="selective-men-carousel"></div>`;
  const selectiveMenCarousel = document.getElementById('selective-men-carousel');
  selectiveMenPerfumes.forEach(p => selectiveMenCarousel.appendChild(createPerfumeItem(p)));

  displaySection.innerHTML += `<hr style="margin: 30px 0;"><h2>${t.woman_header}</h2><div class="perfume-carousel" id="selective-woman-carousel"></div>`;
  const selectiveWomanCarousel = document.getElementById('selective-woman-carousel');
  selectiveWomanPerfumes.forEach(p => selectiveWomanCarousel.appendChild(createPerfumeItem(p)));

  document.querySelectorAll('.add-to-cart').forEach(btn => btn.addEventListener('click', addToCart));
}

function updateCartAndOffers() {
  cart.forEach(item => { item.finalPrice = item.basePrice; item.isDiscounted = false; item.isFreeGift = false; });

  const nicheCount = cart.filter(i => i.type === 'niche').length;
  const selectiveItems = cart.filter(i => i.type.startsWith('selective')).sort((a,b) => a.basePrice - b.basePrice);

  if (selectiveItems.length > 0) {
    const cheapest = selectiveItems[0];
    if (nicheCount === 1) { cheapest.finalPrice = cheapest.basePrice / 2; cheapest.isDiscounted = true; }
    else if (nicheCount >= 2) { cheapest.finalPrice = 0; cheapest.isDiscounted = true; cheapest.isFreeGift = true; }
  }

  renderCartSummary();
}

function renderCartSummary() {
  const cartList = document.getElementById('cart-list');
  const totalPriceDisplay = document.getElementById('total-price-display');
  const shippingInfo = document.getElementById('shipping-info');
  const t = DICT[currentLang];

  cartList.innerHTML = '';
  let subtotal = 0;

  cart.forEach((item, index) => {
    subtotal += item.finalPrice;
    const li = document.createElement('li');
    let priceText = `${item.finalPrice.toFixed(2)}${CURRENCY_SYMBOL}`;
    if (item.isDiscounted) { priceText = item.isFreeGift ? `<span class=\"gift\">${t.msg_gift}</span>` : `<span class=\"discount\">${item.finalPrice.toFixed(2)}${CURRENCY_SYMBOL}</span> (${t.msg_discount})`; }
    li.innerHTML = `
      <div>
        <i class=\"fas fa-trash-alt delete-item\" onclick=\"removeItemFromCart(${index})\"></i>
        ${item.name}
      </div>
      <span>${priceText}</span>
    `;
    cartList.appendChild(li);
  });

  let finalTotal = subtotal;
  if (subtotal > 0) { finalTotal += SHIPPING_FEE; shippingInfo.textContent = t.shipping_text; } else { shippingInfo.textContent = ''; }

  totalPriceDisplay.textContent = finalTotal.toFixed(2) + CURRENCY_SYMBOL;
  document.getElementById('whatsapp-send-button').disabled = cart.length === 0;
}

function parseNumber(v){
  if (typeof v === 'number') return v;
  if (typeof v === 'string') {
    const n = parseFloat(v.replace(/[^0-9.]/g,''));
    return isNaN(n) ? 0 : n;
  }
  return 0;
}

function detectType(productName, typeRaw){
  const t = (typeRaw || '').toLowerCase();
  if (['niche','× ×™×©','Ù†ÙŠØ´'].includes(t)) return 'niche';
  if (['selective_men','men','Ø±Ø¬Ø§Ù„ÙŠ','×œ×’×‘×¨','×’×‘×¨'].includes(t)) return 'selective_men';
  if (['selective_woman','women','Ù†Ø³Ø§Ø¦ÙŠ','×œ××™×©×”','××™×©×”'].includes(t)) return 'selective_woman';
  const low = (productName || '').toLowerCase();
  if (low.includes('Ø±Ø¬Ø§Ù„ÙŠ') || low.includes(' men ') || low.includes('×œ×’×‘×¨') || low.includes(' ×’×‘×¨')) return 'selective_men';
  if (low.includes('Ù†Ø³Ø§Ø¦ÙŠ') || low.includes(' women ') || low.includes('×œ××™×©×”') || low.includes(' ××™×©×”')) return 'selective_woman';
  return 'niche';
}

function fetchAndProcessProducts() {
  $.get(SHEET_URL, function(response){
    try{
      const match = response.match(/google\.visualization\.Query\.setResponse\((.*)\)/);
      if(!match || !match[1]) throw new Error('Bad sheet response');
      const jsonData = JSON.parse(match[1]);
      const rows = (jsonData.table && jsonData.table.rows) ? jsonData.table.rows : [];
      const processed = [];
      for (let i=0; i<rows.length; i++){
        const c = rows[i].c || [];
        const name = (c[0] && c[0].v) ? String(c[0].v).trim() : '';
        const priceC2 = parseNumber(c[2] && c[2].v);
        const image = (c[3] && c[3].v) ? String(c[3].v).trim() : '';
        const typeRaw = (c[4] && c[4].v) ? c[4].v : '';
        const priceF = parseNumber(c[5] && c[5].v);
        const finalPrice = priceF > 0 ? priceF : priceC2;
        if (!name || finalPrice <= 0) continue;
        const type = detectType(name, typeRaw);
        processed.push({
          id: name.substring(0,50) + '-' + (i+2),
          name: (type==='selective_men' ? DICT[currentLang].type_men_prefix : (type==='selective_woman' ? DICT[currentLang].type_woman_prefix : '')) + name,
          price: finalPrice,
          image: image,
          type: type
        });
      }
      allPerfumes = processed;
      if (allPerfumes.length === 0) {
        document.getElementById('perfume-display').innerHTML = `<h2>${DICT[currentLang].error_loading}</h2>`;
      } else {
        renderPerfumes();
      }
      document.getElementById('whatsapp-send-button').disabled = cart.length === 0;
    } catch(e){
      console.error('Sheet parse error:', e);
      document.getElementById('perfume-display').innerHTML = `<h2>${DICT[currentLang].error_loading}</h2>`;
    }
  }).fail(function(){
    document.getElementById('perfume-display').innerHTML = `<h2>${DICT[currentLang].error_loading}</h2>`;
  });
}

function sendOrderViaWhatsApp() {
  const t = DICT[currentLang];
  if (cart.length === 0) { alert(t.cart_empty); return; }
  const nicheCount = cart.filter(x=>x.type==='niche').length;
  let subtotal = 0;
  const lines = cart.map(item=>{
    subtotal += item.finalPrice;
    if (item.isFreeGift) return `- ${item.name}: ğŸ *${t.msg_gift}*`;
    if (item.isDiscounted) return `- ${item.name}: ğŸ’° *${item.finalPrice.toFixed(2)}${CURRENCY_SYMBOL}* (${t.msg_discount})`;
    return `- ${item.name}: ${item.basePrice.toFixed(2)}${CURRENCY_SYMBOL}`;
  });
  const finalTotal = subtotal + SHIPPING_FEE;
  let offerSummary = `\n\n*2. ${t.niche_header}*`;
  if (nicheCount === 1) offerSummary += `\n- Ù†ÙŠØ´ + Ø³Ù„ÙƒØªÙ Ø¨Ù†ØµÙ Ø§Ù„Ø³Ø¹Ø±`;
  else if (nicheCount >= 2) offerSummary += `\n- Ù†ÙŠØ´ + Ø³Ù„ÙƒØªÙ Ù‡Ø¯ÙŠØ© Ù…Ø¬Ø§Ù†ÙŠØ©`;
  else offerSummary += `\n- ${t.msg_no_offer}`;
  let message = `ğŸ‰ *${t.msg_order_complete}*\n\n*1. ×¤×¨×™×˜×™×:*\n` + lines.join('\n');
  message += offerSummary;
  message += `\n\n====================\n`;
  message += `ğŸšš ${t.shipping_text}`;
  message += `\nğŸ’µ *${t.total_text}* ${finalTotal.toFixed(2)}${CURRENCY_SYMBOL}`;
  const pageUrl = window.location.href;
  message += `\n\n${t.complete_order} Ø¹Ø¨Ø± Ø§Ù„Ø±Ø§Ø¨Ø·: ${pageUrl}`;
  window.open(`https://wa.me/${PHONE_NUMBER}?text=${encodeURIComponent(message)}`, '_blank');
}

window.removeItemFromCart = removeItemFromCart;
document.addEventListener('DOMContentLoaded', ()=>{
  setLanguage();
  fetchAndProcessProducts();
  document.getElementById('whatsapp-send-button').addEventListener('click', sendOrderViaWhatsApp);
});
</script>
</body>
</html>
